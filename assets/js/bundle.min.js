!function(){var e={base_url:"http://localhost:3000",hideModal:()=>{const e=document.querySelectorAll(".modal");for(const t of e)t.classList.remove("is-active")}};const t={fillSelectTagModal:async()=>{try{const t=await fetch(e.base_url+"/tags"),a=await t.json(),o=document.querySelector("select");for(const e of a){const t=document.createElement("option");t.textContent=e.name,t.value=e.id,o.append(t)}}catch(t){console.trace(t),alert("Impossible de r\xe9cuperer les tags! ")}},showAddTagModal:e=>{const t=e.target.closest(".box").dataset.cardId;document.querySelector('#addTagModal input[type="hidden"]').setAttribute("value",t),document.querySelector("#addTagModal").classList.add("is-active")},makeTagInDom:e=>{const a=document.createElement("span");a.classList.add("tag"),a.textContent=e.name,a.style.backgroundColor=e.color,a.dataset.tagId=e.id,a.addEventListener("dblclick",t.dissociateTagFromCard),document.querySelector(`.box[data-card-id="${e.card_has_tag.card_id}"] .tags`).append(a)},associateTagToCard:async a=>{a.preventDefault();const o=new FormData(a.target),d=o.get("card_id");try{const a=await fetch(`${e.base_url}/cards/${d}/tags`,{method:"POST",body:o}),r=(await a.json()).tags.find(e=>e.id==o.get("tag_id"));t.makeTagInDom(r),e.hideModal()}catch(r){console.error(r),alert("Impossible d'associer ce tag \xe0 cette carte")}},dissociateTagFromCard:async t=>{const a=t.target.dataset.tagId,o=t.target.closest(".box").dataset.cardId;try{await fetch(`${e.base_url}/cards/${o}/tags/${a}`,{method:"DELETE"}),t.target.remove()}catch(d){console.error(d),alert("Impossible de dissocier le tag de la carte ! ")}}};var a=t;const o={showAddCardModal:e=>{document.querySelector("#addCardModal input[name=list_id]").value=e.target.closest(".panel").getAttribute("data-list-id"),document.getElementById("addCardModal").classList.add("is-active")},onCardDraggable:async function(e){const t=e.from,a=e.to;let d=t.querySelectorAll(".box");await o.moveCards(d),d=a.querySelectorAll(".box"),await o.moveCards(d)},moveCards:async function(t){t.forEach(async(t,a)=>{const o=t.dataset.cardId,d=t.closest(".panel").dataset.listId,r=new FormData;r.set("position",a),r.set("list_id",d);try{await fetch(`${e.base_url}/cards/${o}`,{method:"PATCH",body:r})}catch(s){console.error(s),alert("impossible de d\xe9placer cette carte")}})},handleAddCardForm:async t=>{t.preventDefault();const a=new FormData(t.target),d=await fetch(e.base_url+"/cards",{method:"POST",body:a}),r=await d.json();o.makeCardInDom(r),o.hideCardModal()},makeCardInDom:e=>{const t=document.getElementById("cardTemplate").content.cloneNode(!0);t.querySelector(".column").textContent=e.content;const d=t.querySelector(".box");d.style.backgroundColor=e.color,d.dataset.cardId=e.id,d.querySelector("input[name='card-id']").value=e.id,d.querySelector(".add-tag-icon").addEventListener("click",a.showAddTagModal),d.querySelector(".edit-card-icon").addEventListener("click",o.showEditCardForm),d.querySelector(".delete-card-icon").addEventListener("click",o.deleteCard),d.querySelector("form").addEventListener("submit",o.handleEditCardForm),document.querySelector(`.panel[data-list-id="${e.list_id}"] .panel-block`).append(t)},showEditCardForm:e=>{e.target.closest(".columns").querySelector(".column").classList.add("is-hidden"),e.target.closest(".columns").querySelector("form").classList.remove("is-hidden")},handleEditCardForm:async t=>{t.preventDefault();const a=new FormData(t.target);if(!a.get("content"))return alert("Le nom de la carte ne doit pas etre vide!");try{await fetch(`${e.base_url}/cards/${a.get("card-id")}`,{method:"PATCH",body:a}),t.target.previousElementSibling.innerHTML=a.get("content"),t.target.closest(".box").style.backgroundColor=a.get("color")}catch(o){console.error(o),alert("Impossible de modifier la carte!")}t.target.previousElementSibling.classList.remove("is-hidden"),t.target.classList.add("is-hidden")},deleteCard:async t=>{const a=t.target.closest(".columns").querySelector("input[name='card-id']").value;try{await fetch(`${e.base_url}/cards/${a}`,{method:"DELETE"}),t.target.closest(".box").remove()}catch(o){console.error(o),alert("Impossible de suprimer la carte!")}},hideCardModal:()=>{document.getElementById("addCardModal").classList.remove("is-active")}};var d=o;const r={showAddListModal:()=>{r.modal=document.getElementById("addListModal"),r.modal.classList.add("is-active")},handleAddListForm:async t=>{t.preventDefault();const a=new FormData(t.target),o=await fetch(e.base_url+"/lists",{method:"POST",body:a}),d=await o.json();r.makeListInDom(d),e.hideModal()},makeListInDom:e=>{const t=document.getElementById("listTemplate").content.cloneNode(!0);t.querySelector("h2").textContent=e.name,t.querySelector(".panel").dataset.listId=e.id,t.querySelector('input[name="list-id"]').value=e.id,t.querySelector("a.add-card-icon").addEventListener("click",d.showAddCardModal),t.querySelector("h2").addEventListener("dblclick",r.showEditListForm),t.querySelector(".delete-list-icon").addEventListener("click",r.deleteList),t.querySelector("form").addEventListener("submit",r.handleEditlistForm);const a=t.querySelector(".panel-block");new Sortable(a,{group:"list",draggable:".box",onEnd:d.onCardDraggable}),document.querySelector(".card-lists").append(t)},showEditListForm:async e=>{e.target.classList.add("is-hidden"),e.target.nextElementSibling.classList.remove("is-hidden")},handleEditlistForm:async t=>{t.preventDefault();const a=new FormData(t.target);if(!a.get("name"))return alert("La liste doit avoir un nom !");const o=t.target.previousElementSibling;try{await fetch(`${e.base_url}/lists/${a.get("list-id")}`,{method:"PATCH",body:a}),o.textContent=a.get("name")}catch(d){console.trace(d),alert("La liste n'a pas pu etre modifi\xe9e !")}t.target.classList.add("is-hidden"),o.classList.remove("is-hidden")},deleteList:async t=>{const a=t.target.closest(".panel").dataset.listId;if(confirm("Voulez vous vraiment supprimer cette liste")){if(t.target.closest(".panel").querySelector(".box"))return alert("Impossible de supprimer cette liste car elle poss\xe8de des cartes !");try{await fetch(`${e.base_url}/lists/${a}`,{method:"DELETE"}),t.target.closest(".panel").remove()}catch(o){console.error(o),alert("Impossible de supprimer la liste")}}}};var s=r,c={addListenersToActions:()=>{document.getElementById("addListButton").addEventListener("click",s.showAddListModal);const t=document.querySelectorAll(".close");for(const a of t)a.addEventListener("click",e.hideModal);document.querySelector("#addListModal form").addEventListener("submit",s.handleAddListForm);const o=document.querySelectorAll(".close");for(const e of o)e.addEventListener("click",d.hideCardModal);document.querySelector("#addCardModal form").addEventListener("submit",d.handleAddCardForm),document.querySelector("#addTagModal form").addEventListener("submit",a.associateTagToCard)},getListsFromAPI:async()=>{try{const t=await fetch(e.base_url+"/lists"),o=await t.json();for(const e of o){s.makeListInDom(e);for(const t of e.cards){d.makeCardInDom(t);for(const e of t.tags)a.makeTagInDom(e)}}}catch(t){console.error(t)}},init:function(){c.addListenersToActions(),c.getListsFromAPI(),a.fillSelectTagModal()}};document.addEventListener("DOMContentLoaded",c.init)}();